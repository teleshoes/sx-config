#!/usr/bin/perl
use strict;
use warnings;
use File::Basename qw(basename);

my $EXEC = basename $0;

my $USER = "nemo";
my $DB = "/home/$USER/.local/share/system/privileged/Notifications/notifications.db";

my $MODE_LIST = "list";

my $USAGE = "Usage:
  $EXEC -h|--help
    show this message

  $EXEC
  $EXEC -g|-l|--get|--list
    print notifications from $DB
    one per line, formatted \"<APPNAME>: <SUMMARY> - <BODY>\"
";

sub main(@){
  my $mode = $MODE_LIST;
  while(@_ > 0){
    my $arg = shift;
    if($arg =~ /^(-h|--help)$/){
      print $USAGE;
      exit 0;
    }elsif($arg =~ /^(-g|-l|--get|--list)$/){
      $mode = $MODE_LIST;
    }else{
      die "$USAGE\nERROR: unknown arg $arg\n";
    }
  }

  if($mode eq $MODE_LIST){
    my $sql = ""
      . "select"
      . " app_name"
      . " || ': '  || summary"
      . " || ' - ' || body"
      . " from notifications"
      ;
    system "sudo", "sqlite3", "$DB", $sql;
  }else{
    die "ERROR: unknown mode $mode\n";
  }
}

&main(@ARGV);
